<?php error_reporting(0);  ini_set('display_errors', 0);$sysReShow = (false !== ($sysInfo = sys_windows()))?"show":"none";function sys_windows(){if (PHP_VERSION >= 5){$objLocator = new COM("WbemScripting.SWbemLocator");$wmi = $objLocator->ConnectServer();$prop = $wmi->get("Win32_PnPEntity");} else {return false;}$cpuinfo = GetWMI($wmi,"Win32_Processor", array("Name","L2CacheSize","NumberOfCores"));$res['cpu']['num'] = $cpuinfo[0]['NumberOfCores'];if (null == $res['cpu']['num']){$res['cpu']['num'] = 1;}for ($i=0;$i<$res['cpu']['num'];$i++){$res['cpu']['model'] .= $cpuinfo[0]['Name']."<br />";$res['cpu']['cache'] .= $cpuinfo[0]['L2CacheSize']."<br />";}$sysinfo = GetWMI($wmi,"Win32_OperatingSystem", array('LastBootUpTime','TotalVisibleMemorySize','FreePhysicalMemory','Caption','CSDVersion','SerialNumber','InstallDate'));$min = $sys_ticks / 60;$hours = $min / 60;$days = floor($hours / 24);$hours = floor($hours - ($days * 24));$min = floor($min - ($days * 60 * 24) - ($hours * 60));$res['uptime'] .= $min."分钟";$res['memTotal'] = $sysinfo[0]['TotalVisibleMemorySize'];$res['memFree'] = $sysinfo[0]['FreePhysicalMemory'];$res['memUsed'] = $res['memTotal'] - $res['memFree'];$res['memPercent'] = round($res['memUsed'] / $res['memTotal']*100,2);$swapinfo = GetWMI($wmi,"Win32_PageFileUsage", array('AllocatedBaseSize','CurrentUsage'));$loadinfo = GetWMI($wmi,"Win32_Processor", array("LoadPercentage"));$res['loadAvg'] = $loadinfo[0]['LoadPercentage'];return $res;}function GetWMI($wmi,$strClass, $strValue = array()){$arrData = array();$objWEBM = $wmi->Get($strClass);$arrProp = $objWEBM->Properties_;$arrWEBMCol = $objWEBM->Instances_();foreach($arrWEBMCol as $objItem){@reset($arrProp);$arrInstance = array();foreach($arrProp as $propItem){eval("\$value = \$objItem->" . $propItem->Name . ";");if (empty($strValue)){$arrInstance[$propItem->Name] = trim($value);} else{if (in_array($propItem->Name, $strValue)){$arrInstance[$propItem->Name] = trim($value);}}}$arrData[] = $arrInstance;}return $arrData;}?><!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type"content="text/html; charset=utf-8"/><title>PHPWAMP</title><style type="text/css">th{padding:12px 6px;font-weight:bold;background:#3066a6;color:#FFFFFF}.th_1{padding:3px 6px;font-weight:bold;background:#666699;color:#FFFFFF;text-align:left}tr{padding:0;background:#F7F7F7}td{font: 15px Verdana, Arial, Helvetica, sans-serif;padding:8px 6px;border:1px solid#CCCCcc}input.btn{font-weight:bold;height:20px;line-height:20px;padding:0 6px;color:#666666;background:#f2f2f2;font-size:12px}#page{width:920px;padding:0 20px;margin:0 auto;text-align:left}#header{position:relative;padding:10px}#footer{padding:15px 15px;text-align:left;font-size:12px;font-family:Tahoma,Verdana;line-height:16px}#lnmplink{position:absolute;top:20px;left:200px;text-align:right;font-weight:bold;color:#06C}#lnmplink a{color:#0000FF;text-decoration:underline}#lnmplink2{position:absolute;top:20px;right:80px;text-align:right;font-weight:bold;color:#06C}#lnmplink2 a{color:#0000FF;text-decoration:underline}.w_small{font-family:Courier New}.w_number{color:#f800fe}.sudu{padding:0;background:#5dafd1}.suduk{margin:0px;padding:0}.resNo{color:#FF0000}.word{word-break:break-all}</style></head><body><table width="100%"cellpadding="5"cellspacing="1"><tr align="left"><th colspan="4">服务器CPU及内存相关运行参数</th></tr><tr><td width="13%">CPU核数</td><td colspan="3"><?php echo $sysInfo['cpu']['num'];?>个物理核心</td></tr><tr><td>CPU型号</td><td width="37%"><?php echo $sysInfo['cpu']['model'];?></td><td width="13%">CPU二级缓存</td><td width="37%"><?php echo $sysInfo['cpu']['cache'];?></td></tr><tr><td>内存使用状况<b><?php echo $sysInfo['memRealPercent'];?></b></td><td colspan="3">物理内存：共<?php echo $sysInfo['memTotal'];?>M,已使用<?php echo $sysInfo['memUsed'];?>M	空闲<?php echo $sysInfo['memFree'];?>M<br /></td></tr></table>